#  Spring Cloud Security Oauth2.0实现分布式系统认证

## 1. 环境介绍

`Spring-Security-Oauth2.0` 是对`Oauth2.0` 的一种实现,并且跟`Spring Security`相辅相成,与`Spring Cloud` 体系的集成也非常便利,接下来,我们需要对它进行学习,最终使用它来实现我们设计的分布式认证授权解决方案

`Oauth2.0` 的服务提供方涵盖两个服务,即授权服务(`Authorization Server`,也叫认证服务)和资源服务(`resource Server`),使用 `Spring Security Oauth2.0`的时候, 你可以选择把他们放在同一个应用程序中去实现,也可以选择建立使用同一个授权服务的多个资源服务.

**授权服务(`Authorization Server`)** 应包含对接入端以及登录用户的合法性进行验证并颁发`token` 等功能,对令牌的请求端点由`Spring MVC`控制器进行实现,下面是一个配置一个认证服务必须实现的`endpoints`: 

-  `AuthorizationEndpoint`:' 服务于认证请求, 默认`URL`:`/oauth/authorize `

- `TokenEndpoint` 服务于访问令牌的请求,默认`URL`: `/oauth/token`

  资源服务(`Resource Server`),应包含对资源的保护功能,对非法请求进行拦截,对请求`token` 进行解析鉴权等,下面的过滤器用于实现`Oauth2.0` 资源服务

- `OAuth2AuthenticationProcessingFilter`:用来对请求给出的身份令牌解析鉴权.



本教程分别创建`UAA`认证中心和`order` 订单资源服务

![image-20200730093122909](7.Spring%20Cloud%20Security%20Oauth2.0%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AE%A4%E8%AF%81.assets/image-20200730093122909.png)

认证流程如下:

1. 客户端请求`UAA` 授权服务进行认证
2. 认证通过后由`UAA` 颁发令牌
3. 客户端携带令牌`Token`请求资源服务
4. 资源服务校验令牌的合法性,合法则返回资源信息

##  2. 代码演示

### 2.1 创建父工程

创建`maven` 父工程,依赖如下





